/*
	UIZE JAVASCRIPT FRAMEWORK 2010-10-13

	http://www.uize.com/reference/Uize.Widget.Droplist.html
	Available under MIT License or GNU General Public License -- http://www.uize.com/license.html
*/
Uize.module({name:'Uize.Widget.Droplist',superclass:'Uize.Widget.Picker.Selector',required:['Uize.Widget.PopupPalette','Uize.Node.Event','Uize.Widget.FormElement','Uize.Node'],builder:function(f_a){var f_b=null,f_c=true,f_d=false;var f_e=f_a.subclass(f_b,function(){var f_f=this,f_g=f_f.f_h,f_i=f_f.addChild('palette',Uize.Widget.PopupPalette,{positioning:function(){return f_f.getNode('buttonShell')}}),f_j=f_f.addChild('value',Uize.Widget.FormElement,{warningShown:f_f.get('warningShown')}),f_k=f_f.children.options;function f_l(){f_k.set({values:f_f.get('values')});f_k.set({value:f_f.get('value')});}if(!f_f.f_h){f_l();}else{f_k.set({built:f_c});f_i.wire('Before Palette Shown',function(){if(f_g){f_l();f_g=f_d;}});}f_i.fade.set({duration:0});f_j.wire({'Changed.tentativeValue':function(){f_f.set({tentativeValue:f_j.get('tentativeValue')})},'Changed.value':function(){f_f.set({value:f_j.get('value')})},'Changed.isDirty':function(){f_f.set({isDirty:f_j.get('isDirty')})},
'Changed.isFinished':function(){f_f.set({isFinished:f_j.get('isFinished')})}});f_f.wire({'Changed.isDirty':function(){f_f.f_m()},'Changed.value':function(){f_j.set({value:f_f.get('value')});f_f.f_m();},'Changed.values':function(){var f_n=f_f.get('values');if(f_f.isWired){f_f.f_o();f_f.f_m();var f_p=f_f.getInputNode();if(f_p&&f_f.get('type')=='select-one'){for(var f_q= -1,f_r=f_n.length,f_k=f_p.options,f_s=f_k.length,f_t=f_f.get('nameMappings');++f_q<f_r;){var f_u=f_n[f_q],f_v;if(f_q<f_s){f_v=f_k[f_q];}else{f_v=document.createElement('option');try{f_p.add(f_v,f_b)}catch(f_w){f_p.add(f_v)}}f_f.setNodeProperties(f_v,{value:f_u.name,text:f_u[f_t.displayName],selected:f_f.f_q==f_q});}for(var f_x=f_s-1;f_x>=f_q;f_x--)f_p.remove(f_x);f_p.selectedIndex=f_f.f_q;}}},'Changed.warningShown':function(){f_j.set({warningShown:f_f.get('warningShown')})}});}),f_y=f_e.prototype;f_y.f_m=function(){var f_f=this,f_q=f_f.f_q,f_t=f_f.get('nameMappings');if(f_f.isWired&&f_q> -1){var f_u=f_f.get('values')[f_q],
f_z=f_u&&(f_f.get('isDirty')|| !f_f.f_A),f_B=f_z?f_u[f_t.displayName]:f_f.f_A;f_f.setNodeValue('displayName',f_B);f_f.setNodeProperties(['displayName',f_f.children.palette.children.selector.getNode()],{title:f_B});f_f.setNodeProperties('thumbnail',{src:f_z?f_u[f_t.thumbnail]:'',alt:f_B});f_f.setNodeStyle('thumbnail',{display:f_z?'inline':'none'});}};f_y.f_o=function(){var f_f=this;if(f_f.isWired){var f_t=f_f.get('nameMappings'),f_C=f_f.getNode('displayName'),f_D=f_f.getNodeValue(f_C),f_A=f_f.f_A,f_n=f_f.get('values'),f_r=f_n.length,f_q= -1,f_E=0,f_F;f_f.setNodeStyle(f_C,{width:'auto'});function f_G(f_B){f_f.setNodeValue(f_C,f_B);f_F=Uize.Node.getDimensions(f_C).width;f_E=f_F>f_E?f_F:f_E;}for(;++f_q<f_r;)f_G(f_n[f_q][f_t.displayName]);f_f.f_A&&f_G(f_f.f_A);f_f.setNodeStyle(f_C,{width:f_E});f_f.setNodeValue(f_C,f_D);}};f_y.updateUi=function(){var f_f=this;if(f_f.isWired){f_f.f_m();f_f.f_o();f_a.prototype.updateUi.call(f_f);}};f_y.wireUi=function(){var f_f=this;if(!f_f.isWired){
var f_H=f_f.children.options.getNode();f_f.displayNode('input',!f_H);f_f.children.palette.children.selector.displayNode('',f_H);f_f.children.value.displayNode('input',f_H);f_a.prototype.wireUi.call(f_f);}};f_e.registerProperties({f_h:{name:'deferPopulation',value:f_d},f_A:{name:'nonDirtyLabel',onChange:f_y.f_m,value:''}});f_e.set({nameMappings:{displayName:'displayName',thumbnail:'thumbnail'},valueConformer:{type:'inValues'}});return f_e;}});