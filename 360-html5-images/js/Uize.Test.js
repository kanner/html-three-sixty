/*
	UIZE JAVASCRIPT FRAMEWORK 2010-10-02

	http://www.uize.com/reference/Uize.Test.html
	Available under MIT License or GNU General Public License -- http://www.uize.com/license.html
*/
Uize.module({name:'Uize.Test',required:['Uize.Data','Uize.Json'],builder:function(b_a){var b_b=true,b_c=false,b_d;var b_e=typeof navigator=='object',b_f='\n----------------------------------------------------------\n\n';var b_g=b_a.subclass(),b_h=b_g.prototype;function b_i(b_j,b_k){if(b_k==b_d)return b_j==b_d;if(b_j==b_d)return b_k==Object;if(!(b_j instanceof Function))b_j=b_j.constructor;if(!(b_k instanceof Function))b_k=b_k.constructor;while(b_j!=b_k&&typeof(b_j=b_j.superclass)=='function');return b_j==b_k;}function b_l(b_m){if(b_i(b_m,Uize))return b_m.moduleName||'';var b_n=(b_m+'').match(/function\s+([^\(]+)\s*\(/);return b_n?b_n[1]:'';}function b_o(b_p){return function(){return Uize.Json.to(b_p)};}b_h.b_q=function(b_r,b_s,b_t){b_r||this.set({b_u:'EXPECTED:\n\n'+(typeof b_s=='function'?b_s():b_s)+'\n\n'+'ACTUAL:\n\n'+b_t()});return b_r;};b_h.expect=function(b_v,b_p){return this.b_q(Uize.Data.identical(b_v,b_p),b_o(b_v),b_o(b_p));};b_h.expectSameAs=function(b_v,b_p){return this.b_q(b_v===b_p,b_o(b_v),
b_o(b_p));};b_h.expectNonNull=function(b_p){return this.b_q(b_p!=null,'value that is not null or undefined',b_o(b_p));};b_h.expectInstanceOf=function(b_g,b_p){return this.b_q(b_p!=b_d&&b_p.constructor==(typeof b_g=='string'?eval(b_g):b_g),function(){return'instance of '+b_l(b_g)},function(){return'instance of '+b_l(b_p.constructor)});};b_h.expectType=function(b_w,b_p){return this.b_q(typeof b_p==b_w,function(){return'type '+b_w},function(){return'type '+typeof b_p});};b_h.expectArray=function(b_p){return this.expectInstanceOf(Array,b_p);};b_h.expectBoolean=function(b_p){return this.expectType('boolean',b_p);};b_h.expectFunction=function(b_p){return this.expectType('function',b_p);};b_h.expectNumber=function(b_p){return this.expectType('number',b_p);};b_h.expectObject=function(b_p){return this.expectType('object',b_p);};b_h.expectRegExp=function(b_p){return this.expectInstanceOf(RegExp,b_p);};b_h.expectString=function(b_p){return this.expectType('string',b_p);};b_h.expectArrayLike=function(b_p){return(
this.expectObject(b_p)&&this.expectNonNull(b_p)&&this.expectLengthInRange(0,Infinity,b_p.length));};b_h.expectInRange=function(b_x,b_y,b_p){return this.b_q(Uize.constrain(b_p,b_x,b_y)===b_p,function(){return'value within range '+b_x+' to '+b_y},b_o(b_p));};b_h.expectNumberInRange=function(b_x,b_y,b_p){return this.expectNumber(b_p)&&this.expectInRange(b_x,b_y,b_p);};b_h.expectNegativeNumber=function(b_p){return this.expectNumberInRange(-Infinity,0,b_p);};b_h.expectPositiveNumber=function(b_p){return this.expectNumberInRange(0,Infinity,b_p);};b_h.expectLengthInRange=function(b_z,b_A,b_p){var b_B=b_p.length;return this.b_q(Uize.constrain(b_B,b_z,b_A)===b_B,function(){return'length within range '+b_z+' to '+b_A},function(){return b_B});};b_h.expectNonEmpty=function(b_p){return this.b_q(!Uize.Data.isEmpty(b_p),'non-empty',b_o(b_p));};b_h.expectInteger=function(b_p){return(this.expectNumber(b_p)&&this.b_q(Math.floor(b_p)==b_p,'integer',b_o(b_p)));};b_h.expectIntegerInRange=function(b_x,b_y,b_p){
return this.expectInteger(b_p)&&this.expectInRange(b_x,b_y,b_p);};b_h.expectNegativeInteger=function(b_p){return this.expectInteger(b_p)&&this.expectNegative(b_p);};b_h.expectPositiveInteger=function(b_p){return this.expectInteger(b_p)&&this.expectPositive(b_p);};b_h.expectNoRepeats=function(b_p){return this.b_q(Uize.Data.getTotalKeys(Uize.Data.getLookup(b_p))==b_p.length,'array with no repeated values',b_o(b_p));};b_h.expectNonEmptyArray=function(b_p){return this.expectArray(b_p)&&this.expectNonEmpty(b_p);};b_h.expectNonEmptyObject=function(b_p){return this.expectObject(b_p)&&this.expectNonEmpty(b_p);};b_h.expectNonEmptyString=function(b_p){return this.expectString(b_p)&&this.expectNonEmpty(b_p);};b_h.getDepth=function(){var b_C=0,b_D=this;while(b_D=b_D.parent)b_C++;return b_C;};b_h.getTotalTests=function(){var b_E=0;function b_F(b_G){b_E++;if(Uize.isArray(b_G)){for(var b_H= -1,b_I=b_G.length;++b_H<b_I;)b_F(b_G[b_H].b_J);}}b_F(this.b_J);return b_E;};b_h.getSynopsis=function(){var b_K=this,b_L=b_K.b_L,
b_M=(b_L?'PASSED':'FAILED')+'\n',b_u=b_K.b_u;var b_N=b_K,b_O=[],b_P='',b_Q='';while(b_N){b_O.push(b_N.b_R);b_N=b_N.parent;}for(var b_S=b_O.length;--b_S> -1;){b_P+=b_Q+b_O[b_S]+'\n';b_Q+='   ';}b_M+=b_f+'BREADCRUMBS...\n\n'+b_P;b_M+=b_f+'TIME STARTED: '+b_K.b_T+'\n'+'TIME ENDED: '+b_K.b_U+'\n'+'DURATION: '+b_K.b_V+'ms\n';if(!b_L&&b_u)b_M+=b_f+'REASON FOR FAILURE...\n\n'+b_u;return b_M;};b_h.stop=function(){var b_K=this,b_G=b_K.b_J;if(Uize.isArray(b_G)){for(var b_H= -1,b_I=b_G.length;++b_H<b_I;)b_G[b_H].stop();}b_K.set({b_W:false});};b_h.run=function(b_X){var b_K=this,b_J=b_K.b_J,b_Y=b_b;b_K.stop();b_K.set({b_W:b_b,b_Z:0,b_T:new Date,b_V:b_d,b_U:b_d,b_0:b_c,b_1:[],b_L:b_d,b_u:b_d});b_K.fire({name:'Start',bubble:b_b});function b_2(){b_K.set({b_L:b_Y});if(b_Y==b_0){b_K.set({b_0:b_b});}else{var b_U=new Date;b_K.set({b_V:b_U-b_K.b_T,b_U:b_U,b_Z:1});b_K.stop();b_K.fire({name:'Done',bubble:b_b});b_K.b_0&&b_X&&b_X(b_Y);}}if(Uize.isArray(b_J)){var b_3=b_J.length,b_4= -1;function b_5(){b_K.set({b_Z:(b_4+1)/b_3});
function b_6(b_L){b_Y=b_L;b_5();}while(b_K.b_W&&b_Y===b_b&& ++b_4<b_3)b_Y=b_J[b_4].run(b_6);b_2();}b_5();}else{try{b_Y=b_0;var b_7=b_c,b_8=b_J.call(b_K,function(b_L){b_Y=b_L;b_7&&b_2();});if(b_8!==b_d)b_Y=b_8;b_7=true;}catch(b_9){b_K.set({b_u:'JavaScript Error...\n'+'ERROR NAME: '+b_9.name+'\n'+'ERROR MESSAGE: '+b_9.message+'\n'+'ERROR DESCRIPTION: '+b_9.description+'\n'+'LINE NUMBER: '+b_9.number+'\n'});b_Y=b_c;}if(b_Y!=b_0&&b_e){var b_ba=b_Y;b_Y=b_0;b_2();setTimeout(function(){b_Y=b_ba;b_2();},0);}else{b_2();}}return b_Y;};b_h.log=function(b_bb){this.b_1.push({timestamp:new Date,message:b_bb});};var b_0=b_g.isAsync={};b_g.addTest=function(b_J){(this.b_J||(this.b_J=[])).push(this.declare(b_J));return this;};var b_bc=b_g.splitHostAndProperty=function(b_bd){var b_be=b_bd.lastIndexOf('.');return{host:b_bd.slice(0,b_be),property:b_bd.slice(b_be+1)};};b_g.declare=function(b_J){if(!b_i(b_J,Uize.Test)){var b_bf=b_J;var b_G=b_bf.test;if(Uize.isArray(b_G)){for(var b_H= -1,b_I=b_G.length,b_bg;++b_H<b_I;)
if((b_bg=b_G[b_H]).constructor==Object)b_G[b_H]=this.declare(b_bg);}(b_J=this.subclass()).set(b_bf);}return b_J;};b_g.requiredModulesTest=function(b_bh){return this.declare({title:'REQUIRED MODULES TEST: '+b_bh,test:function(b_5){Uize.module({required:b_bh,builder:function(){b_5(true)}});}});};b_g.staticPropertyTest=function(b_bd,b_w){var b_bi=b_bc(b_bd),b_bj=b_bi.host;return this.declare({title:'Test that '+b_bd+' exists and is a '+b_w,test:[{title:'Test that host '+b_bj+' is defined',test:function(){return this.expectNonNull(eval(b_bj))}},{title:'Test that '+b_bd+' is a '+b_w,test:function(){return this.expectType(b_w,eval(b_bj)[b_bi.property]);}}]});};b_g.staticMethodTest=function(b_bk,b_bl,b_bf){var b_K=this,b_bi=b_bc(b_bk),b_bm=b_bi.host,b_bn=b_bi.property,b_J=[b_K.staticPropertyTest(b_bk,'function')];function b_bo(b_bp){return(Uize.isArray(b_bp)?{title:b_bp[0],test:function(){var b_bq=eval(b_bm),b_br=b_bp[1];return this.expect(b_bp[2],b_bq[b_bn].apply(b_bq,Uize.isArray(b_br)?b_br:[b_br]));}}:b_bp);}
for(var b_bs= -1,b_bt=b_bl.length;++b_bs<b_bt;)b_J.push(b_bo(b_bl[b_bs]));return b_K.declare(Uize.copyInto({title:'STATIC METHOD TEST: '+b_bk,test:b_J},b_bf));};b_g.staticMethodsTest=function(b_bu){var b_J=[];for(var b_bv= -1,b_bw=b_bu.length;++b_bv<b_bw;){var b_bx=b_bu[b_bv];b_J.push(Uize.isArray(b_bx)?this.staticMethodTest.apply(this,b_bx):b_bx);}return this.declare({title:'Static Method Tests',test:b_J});};b_g.testModuleTest=function(b_by){var b_bz=this.requiredModulesTest(b_by);b_bz.set({b_R:'REQUIRE TEST MODULE: '+b_by});return this.declare({title:'TEST MODULE: '+b_by,test:[b_bz,{title:'RUN TEST MODULE: '+b_by,test:function(b_5){var b_K=this,b_bA=new(eval(b_by));b_bA.wire('Done',function(b_bB){var b_bC=b_bB.source;b_bC.b_u&&b_K.set({b_u:'running test module failed with the following synopsis...\n\n'+b_bC.getSynopsis()});b_bC.parent||b_5(b_bC.b_L);});b_bA.run();}}]});};b_g.testSuite=function(b_bD,b_bE){var b_J=[];for(var b_bF= -1,b_bG=b_bE.length;++b_bF<b_bG;)b_J.push(this.testModuleTest(b_bE[b_bF]));
return this.declare({title:b_bD,test:b_J});};b_g.registerProperties({b_V:'duration',b_U:'endTime',b_W:{name:'inProgress',value:b_c},b_0:'isAsync',b_1:'log',b_Z:{name:'progress',value:0},b_u:'reasonForFailure',b_L:'result',b_T:'startTime',b_J:{name:'test',conformer:function(b_p){if(Uize.isArray(b_p)){var b_G=b_p;b_p=[];for(var b_H= -1,b_I=b_G.length;++b_H<b_I;)b_p.push(new b_G[b_H]({parent:this}));}return b_p;}},b_R:'title'});return b_g;}});