/*
	UIZE JAVASCRIPT FRAMEWORK 2010-09-06

	http://www.uize.com/reference/Uize.Wsh.BuildUtils.html
	Available under MIT License or GNU General Public License -- http://www.uize.com/license.html
*/
Uize.module({name:'Uize.Wsh.BuildUtils',required:['Uize.Url','Uize.Template','Uize.Data.Simple','Uize.String.Lines','Uize.Json','Uize.Array.Sort'],builder:function(){var _a=function(){};var _b={};function _c(_d){return _d}_a.getHtmlFilesInfo=function(_e,_f){var _g=[];if(!_f)_f=_c;for(var _h= -1,_i=Uize.Wsh.getFiles(_e),_j=_i.length;++_h<_j;){var _k=_i[_h],_l=Uize.Url.from(_k).file;if(/\.html$/i.test(_l)&&_l.charAt(0)!='~'){var _m=Uize.Wsh.readFile(_k),_n=_m.match(/<meta name="keywords" content="(.*?)"\/>/),_o=_m.match(/<meta name="description" content="(.*?)"\/>/),_p=_m.match(/<link rel="image_src" href="(.*?)"\/>/);_g.push({path:_e+'/'+_l,title:_f(_m.match(/<title>(.*?)<\/title>/)[1]),keywords:_n?_n[1]:'',description:_o?_o[1]:'',imageSrc:_p?Uize.Url.toAbsolute(_e,_p[1]):''});}}Uize.Array.Sort.sortBy(_g,'value.title.toLowerCase ()');return _g;};_a.readSimpleDataFile=function(_q){return Uize.Data.Simple.parse({simple:Uize.Wsh.readFile(_q),collapseChildren:true});};_a.compileJstFile=function(_r){var _s=_b[_r];
if(!_s){if(!Uize.Wsh.fileExists(_r))return;_s=_b[_r]=Uize.Template.compile(Uize.Wsh.readFile(_r),{result:'full'});Uize.module({required:_s.required});}return _s.templateFunction;};_a.processJstFile=function(_r,_t){var _s=_a.compileJstFile(_r);_s&&Uize.Wsh.writeFile({path:_r.replace(/\.jst$/,''),text:_s(_t)});};_a.runScripts=function(_u){var _v;if(!Uize.isArray(_u))_u=[_u];for(var _w= -1,_x=_u.length,_y=new ActiveXObject('WScript.Shell'),_z;++_w<_x&& !_v;)if(_z=_y.Run('WScript '+_u[_w],0,true))_v={script:_u[_w],errorCode:_z};return _v;};_a.runUnitTests=function(_A){Uize.module({required:_A,builder:function(){var _B=new(eval(_A));_B.wire('Done',function(_C){var _D=_C.source,_E=_D.get('result');if(!_E||_D==_B){(WScript.Arguments.Count()&&WScript.Arguments.Item(0)=='silent')||alert(_D.getSynopsis());_E||WScript.Quit(1);}});_B.run();}});};_a.writeDataModule=function(_F,_G,_H){Uize.Wsh.writeFile({path:_F+'\\'+_G+'.js',text:'Uize.module ({\n'+'\tname:\''+_G+'\',\n'+'\tbuilder:function () {\n'+
'\t\treturn function () {\n'+'\t\t\treturn '+Uize.String.Lines.indent(Uize.Json.to(_H),3,'\t',false)+';\n'+'\t\t};\n'+'\t}\n'+'});\n'});};return _a;}});